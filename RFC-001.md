# RFC-001: THE TACTICAL SPIKE

> **Status:** APPROVED FOR EXECUTION  
> **Target:** Zcash Community Grants (ZCG)  
> **Timeline:** 12 Weeks  
> **Budget:** $50,000 USD  
> **Version:** 2.0 (Dual-Mode)

---

## Abstract

Phase 1 of Laminar is a "Tactical Spike"â€”a vertical slice proving the core workflow end-to-end. The goal is not a complete product but an **Operational Iron Core**: a stateless transaction construction engine with **dual-mode operation** that passes the competence filter for both human treasurers and software agents.

---

## Problem Statement

Zcash organizations manage treasury disbursements with a fragile manual workflow:

1. Payroll data in spreadsheets (Google Sheets, Excel)
2. Treasurer manually copies each address into mobile wallet
3. Transactions signed and broadcast one-by-one
4. No standardized receipt or audit trail
5. Process takes 2-4 hours for 50+ recipients

**Pain Points:**
- **Velocity Trap:** Manual copy-paste creates unacceptable time costs
- **Security Theater:** Hot wallets expose seeds to internet-connected surfaces
- **Compliance Black Hole:** No audit-grade proof of payment
- **Automation Gap:** Existing tools cannot be programmatically driven by AI agents

---

## Solution

Laminar separates transaction construction from key storage:

1. **Import:** Treasurer drags CSV into Laminar (or agent invokes CLI)
2. **Validate:** Every row checked (address, amount, memo)
3. **Construct:** Batch assembled into ZIP-321 payment request
4. **Scan:** QR displayed for mobile wallet scanning
5. **Sign:** Wallet signs using locally-stored keys
6. **Broadcast:** Wallet broadcasts to network
7. **Receipt:** Laminar saves JSON receipt for accounting

**Result:** 50-recipient batch in under 5 minutes. Air-gapped. Auditable. **Agent-compatible.**

---

## Dual-Mode Architecture

The `laminar-cli` binary implements automatic interface adaptation via TTY detection:

### Mode A: Operator Interface (Human-Centric)

- Spinner animations during processing
- ASCII tables with color-coded validation status
- Interactive confirmation prompts before fund-affecting operations
- Human-readable error messages with suggestions

### Mode B: Agent Interface (Machine-Centric)

- Silent operation (no spinners, progress text, ASCII art)
- Strict JSON output only, conforming to defined schema
- Non-interactive execution (immediate exit on missing arguments)
- Deterministic output ordering for reliable parsing

**Detection Logic:**
```
if stdout.is_terminal() && !args.output_json { Mode::Operator } else { Mode::Agent }
```

---

## Deliverables

### Milestone 1: The Iron Core

**Timeline:** Weeks 1-5  
**Budget:** $18,000

**Deliverable:** `laminar-core` Rust crate and `laminar-cli` dual-mode binary

**Functionality:**
- CLI tool accepting CSV input
- Output: ZIP-321 URIs and UR-encoded strings
- **Dual-mode operation: Operator mode and Agent mode**
- **TTY detection for automatic mode selection**
- Complete validation engine (addresses, amounts, memos)
- Batch segmentation for large payloads
- JSON receipt generation

**Acceptance Criteria:**
- [ ] `laminar-core` compiles on Rust stable (latest)
- [ ] CLI processes all test vectors successfully
- [ ] Output validates against ZIP-321 specification
- [ ] UR-encoded output scannable by reference decoder
- [ ] **Dual-mode operation verified: TTY detection works correctly**
- [ ] **`--output json` flag forces Agent mode**
- [ ] **Agent mode completes without stdin within timeout**
- [ ] CI/CD pipeline green
- [ ] Documentation complete: README, API reference, examples

---

### Milestone 2: The Interface

**Timeline:** Weeks 6-10  
**Budget:** $15,000

**Deliverable:** Laminar Alpha Desktop Client (v1.0-alpha)

**Functionality:**
- Cross-platform desktop application (macOS, Windows, Linux)
- Drag-and-drop CSV import
- Batch review and validation UI
- Static and animated QR generation
- Local encrypted storage (drafts, address book)

**Acceptance Criteria:**
- [ ] Application installs and launches on all target platforms
- [ ] 50-recipient batch processed end-to-end in under 5 minutes
- [ ] Generated QR successfully scanned by Zashi (iOS or Android)
- [ ] Local storage encryption verified
- [ ] No critical or high-severity bugs in issue tracker
- [ ] Video demonstration provided

---

### Milestone 3: Deployment & Field Manual

**Timeline:** Weeks 11-12  
**Budget:** $2,000

**Deliverable:** Public v1.0 Release + Documentation

**Artifacts:**
- Release binaries (signed, notarized for macOS)
- "The Field Manual": Comprehensive treasurer guide
- Genesis Report: Real payroll processed via Laminar
- **Agent Integration Guide: Documentation for OpenClaw and other agent systems**
- Security review summary and known limitations

**Acceptance Criteria:**
- [ ] Genesis Report published demonstrating real-world use
- [ ] **Agent Integration Test: OpenClaw-driven batch processing demonstrated**
- [ ] Field Manual reviewed and approved
- [ ] All known issues documented with workarounds
- [ ] Release binaries signed and published

---

## Success Metrics

The Tactical Spike succeeds if it demonstrates:

| Metric | Target |
|--------|--------|
| Batch processing time | 50 recipients in < 5 minutes |
| Wallet compatibility | Zashi accepts generated ZIP-321 |
| UR support | Animated QR sequences work for large batches |
| Address validation | 100% accuracy (zero false positives/negatives) |
| Real-world proof | Genesis Report using actual grant payroll |
| **Agent integration** | **Successful OpenClaw-driven batch processing** |

---

## Testing Requirements

### Dual-Mode Test Suite

| Test | Description |
|------|-------------|
| TTY Detection | Verify Mode A activates with terminal, Mode B with pipe |
| Flag Override | Verify `--output json` forces Mode B regardless of TTY |
| JSON Validity | All Mode B output parses as valid JSON |
| Non-Blocking | Mode B completes without stdin within timeout |
| Confirmation Prompts | Mode A prompts appear, Mode B skips automatically |
| Output Determinism | Same input produces identical JSON across runs |

### Test Vectors

| File | Purpose | Expected Result |
|------|---------|-----------------|
| `valid-simple.csv` | 10 valid recipients | Success, single QR |
| `valid-large.csv` | 100 valid recipients | Success, animated UR |
| `invalid-address.csv` | Malformed address | E001 error |
| `invalid-amount.csv` | Negative amount | E003 error |
| `invalid-memo.csv` | Oversized memo | E005 error |
| `mixed-networks.csv` | Mainnet + Testnet | E002 error |
| `unicode-memo.csv` | International characters | Success |
| `precision-edge.csv` | Precision boundaries | Success |

---

## Out of Scope (Phase 1)

| Feature | Phase |
|---------|-------|
| Network broadcasting | Never (architectural constraint) |
| Hardware wallet integration | Phase 2 |
| PDF receipt generation | Phase 2 |
| Multi-signature workflows | Phase 2 |
| External security audit | Phase 2 |
| Full OpenClaw integration | Phase 3 |
| Public SDK | Phase 3 |

---

## Risk Register

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Zashi rejects UR payloads | Medium | High | Early testing, fallback to smaller batches |
| YWallet lacks UR support | High | Medium | Static QR fallback with batch splitting |
| librustzcash API changes | Low | High | Pin dependency versions, monitor releases |
| Large batch performance | Medium | Medium | Performance testing during M1 |
| **TTY detection edge cases** | Low | Medium | Explicit `--output json` flag as fallback |
| **Agent timeout issues** | Low | Low | Document timeout requirements, progress in JSON |

---

## References

- [Laminar PRD v2.0](../Laminar_PRD_v2_Dual_Mode.pdf)
- [ZIP-321: Payment Request URIs](https://zips.z.cash/zip-0321)
- [UR: Uniform Resources](https://github.com/BlockchainCommons/Research/blob/master/papers/bcr-2020-005-ur.md)
